<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - PROFIT GAINER</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/investments.css">
  <style>
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
    }
    .gain-positive { color: #28a745 !important; }
    .gain-negative { color: #dc3545 !important; }
  </style>
</head>
<body>
  <!-- Sidebar (desktop only) -->
  <aside class="sidebar d-none d-md-flex" aria-label="Primary">
    <div class="sidebar-header text-center mb-4">
      <h2><i class="fa-solid fa-coins text-warning"></i> PROFIT GAINER</h2>
    </div>
    <ul class="sidebar-menu list-unstyled">
      <li><a href="/dashboard"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
      <li><a href="/profile"><i class="fa-solid fa-user"></i> Profile</a></li>
      <li><a href="/deposits"><i class="fa-solid fa-wallet"></i> Deposits</a></li>
      <li><a href="/wallet"><i class="fa-solid fa-money-bill-transfer"></i> Wallet</a></li>
      <li><a href="/applyFunds"><i class="fa-solid fa-hand-holding-dollar"></i> Apply Funds</a></li>
      <li><a href="/investments" class="active"><i class="fa-solid fa-briefcase"></i> Investments</a></li>
      <li><a href="/support"><i class="fa-solid fa-headset"></i> Support</a></li>
      <li><a href="/logout" class="text-danger"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
    </ul>
  </aside>

  <!-- Mobile Navbar -->
  <nav class="navbar navbar-dark glass-nav d-md-none fixed-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <span class="navbar-brand mb-0 h5 text-warning fw-bold d-flex align-items-center nowrap">
        <i class="fa-solid fa-coins me-2"></i> PROFIT GAINER
      </span>
      <button class="btn btn-outline-light" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu" aria-controls="mobileMenu" aria-label="Open navigation">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
  </nav>

  <!-- Offcanvas Menu (mobile only) -->
  <div class="offcanvas offcanvas-start glass-nav text-white d-md-none" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileMenuLabel"><i class="fa-solid fa-coins text-warning"></i> PROFIT GAINER</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="mobile-nav list-unstyled">
        <li><a href="/dashboard" class="nav-link"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="/profile" class="nav-link"><i class="fa-solid fa-user"></i> Profile</a></li>
        <li><a href="/deposits" class="nav-link"><i class="fa-solid fa-wallet"></i> Deposits</a></li>
        <li><a href="/wallet" class="nav-link"><i class="fa-solid fa-money-bill-transfer"></i> Wallet</a></li>
        <li><a href="/applyFunds" class="nav-link"><i class="fa-solid fa-hand-holding-dollar"></i> Apply Funds</a></li>
        <li><a href="/investments" class="nav-link active"><i class="fa-solid fa-briefcase"></i> Investments</a></li>
        <li><a href="/support" class="nav-link"><i class="fa-solid fa-headset"></i> Support</a></li>
        <li><a href="/logout" class="nav-link text-danger"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
      </ul>
    </div>
  </div>

  <!-- Main content -->
  <main class="main-content">
    <header class="main-header text-center mb-4">
      <h1>Investments Dashboard</h1>
      <p>Track and grow your crypto investments</p>
    </header>

    <!-- Flash Messages -->
    <div class="container mb-4">
      <% if (success && success.length > 0) { %>
        <% success.forEach(message => { %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% }) %>
      <% } %>
      <% if (error && error.length > 0) { %>
        <% error.forEach(message => { %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% }) %>
      <% } %>
    </div>

    <div class="container py-4">
      <div class="row g-4 justify-content-center equal-cards">
        <!-- Investment Summary with Gain % -->
        <div class="col-lg-5 col-md-6 d-flex">
          <div class="glass-card p-4 text-center flex-fill shadow">
            <h3>Total Invested</h3>
            <h2 class="text-info">$<%= Number(stats.totalInvested).toLocaleString() %></h2>
            <hr>
            <h3>Total Profit</h3>
            <h2 class="<%= stats.totalProfit >= 0 ? 'text-success' : 'text-danger' %>">
              $<%= Number(stats.totalProfit).toLocaleString() %>
            </h2>
            <hr>
            <h3>Overall Return</h3>
            <h2 class="<%= stats.total_gain_percentage >= 0 ? 'gain-positive' : 'gain-negative' %> fw-bold">
              <%= stats.total_gain_percentage > 0 ? '+' : '' %><%= stats.total_gain_percentage %>%
            </h2>
          </div>
        </div>

        <!-- New Investment Form -->
        <div class="col-lg-5 col-md-6 d-flex">
          <div class="glass-card p-4 flex-fill shadow">
            <h3 class="mb-3 text-center">Make a New Investment</h3>
            <form action="/investments/add" method="POST">
              <div class="mb-3">
                <label for="amount" class="form-label text-white">Amount (USD)</label>
                <input type="number" class="form-control bg-dark text-white" name="amount" id="amount" min="500" max="5000000" step="0.01" required>
              </div>
              <div class="mb-3">
                <label for="plan" class="form-label text-white">Plan</label>
                <select class="form-select bg-dark text-white" name="plan" id="plan" required>
                  <option value="">Select Plan</option>
                  <option value="Bronze">Bronze ($500 - $10,000)</option>
                  <option value="Silver">Silver ($10,001 - $50,000)</option>
                  <option value="Gold">Gold ($50,001 and above)</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="asset_name" class="form-label text-white">Asset</label>
                <select class="form-select bg-dark text-white" name="asset_name" id="asset_name" required>
                  <option value="">Select Asset</option>
                  <option value="Bitcoin">Bitcoin</option>
                  <option value="Ethereum">Ethereum</option>
                  <option value="Litecoin">Litecoin</option>
                  <option value="Ripple">Ripple</option>
                </select>
              </div>
              <button type="submit" class="btn btn-warning w-100 fw-bold">Invest Now</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Investments Table with Gain % -->
      <div class="row mt-5">
        <div class="col-12">
          <div class="glass-card p-4 shadow">
            <h3 class="mb-3 text-white">Your Investments</h3>
            <div class="table-responsive">
              <table class="table table-dark table-hover align-middle">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Asset</th>
                    <th>Plan</th>
                    <th>Amount</th>
                    <th>Profit</th>
                    <th>Gain %</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (investments && investments.length > 0) { %>
                    <% investments.forEach(inv => { %>
                      <tr>
                        <td><%= new Date(inv.created_at).toLocaleDateString() %></td>
                        <td><strong><%= inv.asset_name %></strong></td>
                        <td><%= inv.plan %></td>
                        <td>$<%= Number(inv.amount).toLocaleString() %></td>
                        <td class="<%= inv.profit >= 0 ? 'text-success' : 'text-danger' %> fw-bold">
                          $<%= Number(inv.profit).toLocaleString() %>
                        </td>
                        <td class="<%= parseFloat(inv.gain_percentage) >= 0 ? 'gain-positive' : 'gain-negative' %> fw-bold">
                          <%= parseFloat(inv.gain_percentage) > 0 ? '+' : '' %><%= inv.gain_percentage %>%
                        </td>
                      </tr>
                    <% }) %>
                  <% } else { %>
                    <tr>
                      <td colspan="6" class="text-center text-muted py-4">No investments yet. Start growing your portfolio today!</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer text-center mt-5 py-4">
      <p class="text-muted">Â© 2026 Profit-Gainer Platform. All rights reserved.</p>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Auto-update Plan based on Amount -->
  <script>
    const amountInput = document.getElementById('amount');
    const planSelect = document.getElementById('plan');

    amountInput.addEventListener('input', () => {
      let val = parseFloat(amountInput.value) || 0;

      if (val >= 500 && val <= 10000) {
        planSelect.value = 'Bronze';
      } else if (val >= 10001 && val <= 50000) {
        planSelect.value = 'Silver';
      } else if (val >= 50001) {
        planSelect.value = 'Gold';
      } else {
        planSelect.value = '';
      }
    });
  </script>
</body>
</html>